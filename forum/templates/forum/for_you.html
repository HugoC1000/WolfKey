{% extends 'forum/base.html' %}

{% block head %}
{%load static %}
    <link rel="stylesheet" href="{% static 'forum/css/schedule.css' %}"> 
    <link rel="stylesheet" href="{% static 'forum/css/post-card.css' %}"> 


{% endblock %}
{% block content %}
    <div class="d-flex justify-content-center align-items-center mb-2">
        <h1 class="fade-text" id="animated-text">{{ greeting }}</h1>
    </div>

    <!-- Schedule-->
    <div class="row" style = "margin-bottom: 3rem;">
        <div class="col-md-8">
            <div class="d-flex flex-wrap gap-4">
                <!-- Today's Schedule -->
                <div class="flex-fill">
                    <div class = "card">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <h3 style = "font-size: 1.5rem;">Today's Schedule</h3>
                            <span class="text-muted" id="current-date">
                                {{ current_date}}
                            </span>
                        </div>
                        <ul class="list-group shadow-sm rounded"id = "today-schedule">
                            {% if ceremonial_required_today %}
                            <li class="list-group-item">
                                ðŸ‘” Ceremonial Required
                            </li>
                            {% endif %}
                            {% for item in schedule_today %}
                            {% if item == "no school"  %}
                            <li class="list-group-item">
                                <p style = "margin-bottom: 0px;">No School</p>
                            </li>
                            {% else %}
                                {% if item.block != "No Block" %}
                                <li class="list-group-item">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <p style = "margin-bottom: 0px;">{{ item.block }}</p>
                                        <p style = "margin-bottom: 0px;">{{ item.time }} </p>
                                    </div>
                                </li>
                                {% endif %}
                            {% endif %}
                            {% endfor %}
                        </ul>
                    </div>

                </div>
    
                <!-- Tomorrow's Schedule -->
                <div class="flex-fill">
                    <div class = "card">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <h3 style = "font-size: 1.5rem;">Tomorrow's Schedule</h3>
                        <span class="text-muted" id="tomorrow-date">
                            {{ tomorrow_date}}
                        </span>
                    </div>
                    <ul class="list-group shadow-sm rounded" id = "tomorrow-schedule">
                        {% if ceremonial_required_tomorrow %}
                        <li class="list-group-item">
                            ðŸ‘” Ceremonial Required
                        </li>
                        {% endif %}
                        {% for item in schedule_tomorrow %}
                        {% if item == "no school"  %}
                        <li class="list-group-item">
                            <p style = "margin-bottom: 0px;">No School</p>
                        </li>
                        {% else %}
                        <li class="list-group-item">
                            <div class="d-flex justify-content-between align-items-center mb-1">
                                <p style = "margin-bottom: 0px;">{{ item.block }}</p>
                                <p style = "margin-bottom: 0px;">{{ item.time }} </p>
                            </div>
                        </li>
                        {% endif %}
                        {% endfor %}
                    </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- Leaderboard -->
        <div class="col-md-4 d-none d-md-block">
            <!-- Reserved space -->
        </div>
    </div>

    <!-- Display the posts -->
    <div class="row" id="post-list">
        {% for post in posts %}
            <div class="mb-3 post-card-container" style = "max-width: 800px; margin: 0 auto; margin-bottom: .75rem;" data-animate>
                {% include 'forum/components/post_card.html' with post=post %}
            </div>
        {% endfor %}
    </div>

    <p>Add more interested courses <a href="{% url 'profile' user.username %}">here</a> in your profile to see more posts tailored towards you.</p>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const postCards = document.querySelectorAll('[data-animate]');

        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    // Add animation class when the card is visible
                    entry.target.classList.add('animate-visible');
                    observer.unobserve(entry.target); // Stop observing once animated
                }
            });
        }, {
            threshold: 0.02 // Trigger when 2% of the card is visible
        });

        postCards.forEach(card => observer.observe(card));
    });
</script>
{% endblock %}