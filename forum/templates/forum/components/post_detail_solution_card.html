{% load custom_filters %}


<div class="solution-container {% if solution == accepted_solution %}accepted-solution{% endif %}" data-solution-id="{{ solution.id }}">

    <!-- Solution Vote Cell -->
    <div class="vote-cell">
        {% csrf_token %}
        <button type="button" 
                class="vote-button {% if solution|has_upvoted:user %}voted-up{% endif %}" 
                data-vote-type="upvote"
                onclick="solutionInteractions.upvoteSolution('{{ solution.id }}')">
            <svg width="36" height="36" viewBox="0 0 36 36">
                <path d="M2 26h32L18 10 2 26z"></path>
            </svg>
        </button>
        
        <div class="vote-count">{{ solution|vote_difference }}</div>
        
        <button type="button" 
                class="vote-button {% if solution|has_downvoted:user %}voted-down{% endif %}" 
                data-vote-type="downvote"
                onclick="solutionInteractions.downvoteSolution('{{ solution.id }}')">
            <svg width="36" height="36" viewBox="0 0 36 36">
                <path d="M2 10h32L18 26 2 10z"></path>
            </svg>
        </button>

        {% if user == post.author %}
        <button type="button" 
                class="accept-solution-button {% if solution == accepted_solution %}accept-button-accepted{% else %}accept-button-unaccepted{% endif %}"
                data-solution-id="{{ solution.id }}"
                onclick="solutionInteractions.toggleAcceptSolution('{{ solution.id }}')"
                title="{% if solution == accepted_solution %}Unaccept this answer{% else %}Accept this answer{% endif %}">
            <svg aria-hidden="true" class="m0 svg-icon iconCheckmarkLg" width="36" height="36" viewBox="0 0 36 36">
                <path d="m6 14 8 8L30 6v8L14 30l-8-8z"></path>
            </svg>
        </button>
        {% endif %}
        
        <!-- Solution Saving-->
        {% if user.is_authenticated %}
        <button type="button" 
                class="bookmark-button {% if solution|is_saved_solution:user %}active{% endif %}" 
                onclick="solutionInteractions.toggleSaveSolution('{{ solution.id }}')"
                title="{% if solution|is_saved_solution:user %}Unsave{% else %}Save{% endif %}">
            <i class="{% if solution|is_saved_solution:user %}fas{% else %}far{% endif %} fa-bookmark mt-2"></i>
        </button>
        {% endif %}
    </div>

    <!-- Solution Content -->
    <div class="post-content-cell">
        <!-- Solution Author -->
        <div class="author-info mt-3">
            <div class="position-relative">
                <img 
                    src="{{ solution.author.userprofile.profile_picture.url }}" 
                    alt="Profile Picture" 
                    class="profile-picture"
                    style="width: 30px; height: 30px; border-radius: 50%; object-fit: cover; cursor: pointer;"
                    id="profilePicture"
                >
            </div>
            <div>
                <div class="d-flex align-items-center">
                    <a href="{{ solution.author.get_absolute_url }}">{{ solution.author.get_full_name }}</a>
                    {% if solution.author == post.author %}
                        <span class="badge bg-primary ms-2">OP</span>
                    {% endif %}
                </div>
                <div class="text-muted">Answered {{ solution.created_at|date:"M d, Y" }}</div>
            </div>
        </div>
        <div id="editorjs-solution-{{ solution.id }}"></div>

        <!-- Solution Actions -->
        {% if user.is_authenticated %}
        <div class="solution-actions mt-3 d-flex justify-content-between align-items-center" data-solution-id="{{ solution.id }}">
    
            <!-- Left: Add Comment Button -->
            {% if user.is_authenticated %}
            <div>
                <button class="reply-button btn pill-btn btn-outline-secondary btn-sm" 
                        data-solution-id="{{ solution.id }}">
                    Add a comment
                </button>
            </div>
            {% endif %}

            <!-- Right: Edit/Delete Buttons -->
            {% if user == solution.author %}
            <div class="text-end">
                <div class="default-actions d-flex gap-2">
                    <button class="btn pill-btn btn-outline-secondary btn-sm"
                            onclick="showEditSolutionForm(Number('{{ solution.id }}'))">
                        <i class="bi bi-pencil"></i> Edit
                    </button>
                    <button type="submit" class="btn pill-btn btn-outline-danger btn-sm">
                        <i class="bi bi-trash"></i> Delete
                    </button>
                </div>
                <div class="edit-actions mt-2" style="display: none;">
                    <button class="btn btn-primary btn-sm" onclick="saveSolutionEdit(Number('{{ solution.id }}'))">Save</button>
                    <button class="btn btn-secondary btn-sm" onclick="cancelSolutionEdit(Number('{{ solution.id }}'))">Cancel</button>
                </div>
            </div>
            {% endif %}
        </div>


        {% endif %}

        <!-- Comments -->
        <div class="comments-section">
            <br>
            <div class="comments">
                {% include 'forum/components/comments_list.html' with comments=solution.comments.all %}
            </div>
        </div>
    </div>
</div>